<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Subscribe to {{ plan.name }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .card {
            border-radius: 15px;
            padding: 30px 20px;
        }
        .benefits-list li {
            margin-bottom: 12px;
            font-size: 1.1rem;
        }
        .price {
            font-size: 2rem;
            font-weight: bold;
            color: #0d6efd;
        }
        .duration {
            font-size: 1.2rem;
            color: #6c757d;
        }
        #paypal-button-container {
            margin-top: 25px;
        }
    </style>
</head>
<body>
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card shadow-sm text-center">
                <div class="card-body">
                

                    <div class="card-body text-center">
                        <h2 class="card-title mb-3">{{ plan.name }} Membership</h2>
                        <p class="text-muted mb-3">{{ plan.description }}</p>
                        <p class="h4 text-primary mb-4">
                            ${{ plan.price }} per {{ plan.duration_days }} days
                        </p>
                        <div id="paypal-button-container" class="d-flex justify-content-center"></div>
                    </div>

                    <!-- PayPal Button -->
                    <div id="paypal-button-container" class="d-flex justify-content-center"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- PayPal SDK -->
<script src="https://www.paypal.com/sdk/js?client-id={{ paypal_client_id }}&vault=true&intent=subscription"></script>
<script>
paypal.Buttons({
    style: {
        layout: 'vertical',
        color:  'gold',
        shape:  'pill',
        label:  'subscribe'
    },
    createSubscription: function (data, actions) {
        return actions.subscription.create({
            plan_id: "{{ paypal_plan_id }}",
        });
    },
    onApprove: function (data, actions) {
        return fetch("{% url 'paypal_payments:paypal_subscription_complete' %}", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "X-CSRFToken": "{{ csrf_token }}",
            },
            body: JSON.stringify({
                subscription_id: data.subscriptionID,
            }),
        })
        .then(res => res.json())
        .then(res => {
            if (res.ok) {
                alert("Subscription successful! Status: " + res.subscription_status);
                window.location.href = "http://127.0.0.1:8000/admin";
            } else {
                alert("Subscription failed: " + res.error);
            }
        });
    },
}).render("#paypal-button-container");
</script>
</body>
</html>



<!-- 
<h2>Subscribe to {{ plan.name }} Membership</h2>

<div id="paypal-button-container"></div>

<script src="https://www.paypal.com/sdk/js?client-id={{ paypal_client_id }}&vault=true&intent=subscription"></script>
<script>
  paypal
    .Buttons({
      createSubscription: function (data, actions) {
        return actions.subscription.create({
          plan_id: "{{ paypal_plan_id }}",
        });
      },
      onApprove: function (data, actions) {
        return fetch("http://127.0.0.1:8000/subscriptions/complete/", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "X-CSRFToken": "{{ csrf_token }}",
          },
          body: JSON.stringify({
            subscription_id: data.subscriptionID,
          }),
        })
          .then((res) => res.json())
          .then((res) => {
            if (res.ok) {
              alert(
                "Subscription successful! Status: " + res.subscription_status
              );
              window.location.href = "http://127.0.0.1:8000/admin"; // redirect home
            } else {
              alert("Subscription failed: " + res.error);
            }
          });
      },
    })
    .render("#paypal-button-container");
</script> -->
