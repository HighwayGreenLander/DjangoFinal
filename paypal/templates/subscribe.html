<h2>Subscribe to Pro Membership</h2>

<div id="paypal-button-container"></div>

<script src="https://www.paypal.com/sdk/js?client-id={{ paypal_client_id }}&vault=true&intent=subscription"></script>
<script>
  paypal
    .Buttons({
      createSubscription: function (data, actions) {
        return actions.subscription.create({
          plan_id: "{{ paypal_plan_id }}",
        });
      },
      onApprove: function (data, actions) {
        return fetch("http://127.0.0.1:8000/complete/", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "X-CSRFToken": "{{ csrf_token }}",
          },
          body: JSON.stringify({
            subscription_id: data.subscriptionID,
          }),
        })
          .then((res) => res.json())
          .then((res) => {
            if (res.ok) {
              alert(
                "Subscription successful! Status: " + res.subscription_status
              );
              window.location.href = "http://127.0.0.1:8000/admin"; // redirect home
            } else {
              alert("Subscription failed: " + res.error);
            }
          });
      },
    })
    .render("#paypal-button-container");
</script>
